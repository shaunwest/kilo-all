!function(t){"use strict";function e(t,e){var n,r,o;for(n=0;n<t.length;n++)if(r=t[n],o=e.match(r.pattern))return{key:o[1],cb:r.cb};return null}function n(t,e){return e?e(t):t}function r(t){var e;t&&("complete"===document.readyState?t(document):e=setInterval(function(){"complete"===document.readyState&&(t(document),clearInterval(e))},10))}function o(t){var e;if(l.isObject(t))for(e in t)t.hasOwnProperty(e)&&f.register(e,[],function(t){return function(){return t}}(t[e]))}function i(t,e,n){r(function(r){var o,i,s,u,c,a=[];if(e)u=e.querySelectorAll("*");else{if(!p){if(e=r.getElementsByTagName("body"),!e||!e[0])return;p=e[0].querySelectorAll("*")}u=p}for(c=t.indexOf("[]"),-1!==c&&(t=t.substring(0,c)),o=0,i=u.length;i>o;o++)s=u[o],s.hasAttribute("data-"+t)&&a.push(s);n(-1===c?a[0]:a)})}function s(t,e){switch(t){case"application/json":case"application/json; charset=utf-8":return JSON.parse(e);default:return e}}function u(t,e,n){var r=new XMLHttpRequest;n&&r.addEventListener("progress",function(t){n(t.loaded,t.total)},!1),r.onerror=function(){l.error("Network error.")},r.onload=function(){var t=t||this.getResponseHeader("content-type");switch(this.status){case 500:case 404:e(this.statusText,this.status);break;case 304:default:e(s(t,this.responseText),this.status)}},r.open("get",t,!0),r.send()}function c(t,e,n,r){l.isArray(e)&&l.isFunction(n)?f.register(t,e,n,r):l.isFunction(e)&&f.register(t,[],e,n)}var a,l,f,h,p,d={},g=void 0,m=t;l={isDefined:function(t){return"undefined"!=typeof t},isBoolean:function(t){return"boolean"==typeof t},def:function(t,e){return"undefined"==typeof t?e:t},error:function(t){throw new Error(m+": "+t)},warn:function(t){l.log("Warning: "+t)},log:function(t){a.log&&console.log(m+": "+t)},argsToArray:function(t){return Array.prototype.slice.call(t)},getGID:function(t){return t=l.def(t,""),d[t]=l.def(d[t],0),t+ ++d[t]},rand:function(t,e){return e=e||0,(e>t||e>t)&&l.error("rand: invalid range."),Math.floor(Math.random()*(t-e+1))+e}},h=["Array","Object","Arguments","Function","String","Number","Date","RegExp","HTMLImageElement"];for(var v=0;v<h.length;v++)l["is"+h[v]]=function(t){return function(e){return Object.prototype.toString.call(e)==="[object "+t+"]"}}(h[v]);return f={unresolved:{},modules:{},interceptors:[],register:function(t,e,n,r){return this.unresolve(t),this.unresolved[t]={deps:e,func:n,scope:r},this},unresolve:function(t){return this.modules[t]&&delete this.modules[t],this},setModule:function(t,e){return this.modules[t]=e,this},getDependency:function(t,r){var o,s,u,c;return u=e(this.interceptors,t),u&&(c=u.cb,t=u.key),o=this.modules,(s=o[t])?(s=n(s,c),void r(s)):-1!=t.indexOf("/")?void this.modules.httpGet(t,r):(s=this.unresolved[t])?(l.log("Resolving dependencies for '"+t+"'"),void this.resolveAndApply(s.deps,s.func,s.scope,function(e){l.isObject(e)&&(e.getType=function(){return t}),o[t]=e,e=n(e,c),r(e)})):void i(t,null,function(e){e?(e=n(e,c),r(e)):l.warn("Module '"+t+"' not found")})},resolve:function(t,e,n,r){var o=this;n=l.def(n,0);var i=t[n];return i?void this.getDependency(i,function(s){r||(r=[]),s?r.push(s):l.error("Can't resolve "+i),o.resolve(t,e,n+1,r)}):void e(r)},apply:function(t,e,n){var r=e.apply(n||a,t);return r},resolveAndApply:function(t,e,n,r){var o=this;this.resolve(t,function(t){var i=o.apply(t,e,n);r&&l.isFunction(r)&&r(i)})},addInterceptor:function(t,e){this.interceptors.push({pattern:t,cb:e})},process:function(t,e){var n,r,o;if(l.isArray(t))for(n=0,r=t.length;r>n;n++)o=t[n],l.isString(o)?this.getDependency(o,function(t){e(t)}):e(o);else l.isString(t)?this.getDependency(t,function(t){e(t)}):e(t)}},a=function(){},a.use=function(t,e,n,r){var o;l.isString(t)?f.resolveAndApply([t],e,n,r):l.isArray(t)?f.resolveAndApply(t,e,n,r):l.isFunction(t)&&(o=f.apply([],t,e),r&&r(o))},a.use.defer=function(t,e,n){return function(r){a.use(t,e,n,r)}},a.use.run=function(t,e){var n,r,o,i=function(){var i=arguments;return a.use(t,function(t){return l.isFunction(t)?(o=t.apply(null,i),n&&n(o),r=!0,o):void 0},e),{on:function(t){r?t(o):n=t}}};return i},a.register=function(t,e,n,r){return l.isFunction(e)||l.isFunction(n)?c(t,e,n,r):{depends:function(){return e=l.argsToArray(arguments),this},factory:function(n,r){c(t,e,n,r)}}},a.unresolve=function(t){f.unresolve(t)},a.noConflict=function(){return window[t]=g,a},a.onDocumentReady=r,a.log=!0,f.setModule("Util",l).setModule("Injector",f).setModule("element",i).setModule("registerAll",o).setModule("httpGet",u),"undefined"!=typeof window&&(window[t]&&(l.warn("a preexisting value at namespace '"+t+"' has been overwritten."),g=window[t]),window[t]=a,window.register||(window.register=a.register),window.use||(window.use=a.use)),"undefined"!=typeof exports&&(exports[t]=a,exports.register=a.register,exports.use=a.use),a}("kilo"),register("Canvas",[],function(){"use strict";return{clearContext:function(t,e,n){t.clearRect(0,0,e,n)},drawBackground:function(t,e,n,r,o,i){t.fillStyle=i||"red",t.fillRect(r||0,o||0,e,n)},drawBorder:function(t,e,n,r,o,i){t.beginPath(),t.strokeStyle=i||"black",t.rect(r||0,o||0,e,n),t.stroke(),t.closePath()}}}),register("Factory",["Obj","Pool"],function(t){"use strict";return function(e){var n=t.mixin([e]);return n}}),register("Func",[],function(){"use strict";function t(t){var e=Array.prototype.slice.call(arguments,1);return function(){for(var n=e.slice(),r=0;r<arguments.length;r++)n.push(arguments[r]);return t.apply(this,n)}}function e(e,n){return t(n,e)}function n(t){return function(){var e=Array.prototype.slice.call(arguments),n=e.length;return function(r){return e[n]=r,t.apply(this,e)}}}return{partial:t,fastPartial:n,wrap:e}}),register("HashArray",function(){"use strict";function t(){this.values=[],this.keyMap={}}function e(t,e){var n;for(n in t)t.hasOwnProperty(n)&&t[n]>e&&t[n]--}function n(t,e){var n;for(n in t)t.hasOwnProperty(n)&&t[n]>=e&&t[n]++}return t.prototype.set=function(t,e){return this.keyMap[t]?(this.values[this.keyMap[t]]=e,!0):(this.values.push(e),this.keyMap[t]=this.values.length-1,!1)},t.prototype.splice=function(t,e,r){var o=this.keyMap[t]+1;this.values.splice(o,0,r),n(this.keyMap,o),this.keyMap[e]=o},t.prototype.get=function(t){return this.values[this.keyMap[t]]},t.prototype.remove=function(t){var n=this.keyMap[t];this.values.splice(n,1),e(this.keyMap,n),delete this.keyMap[t]},t.prototype.removeAll=function(){var t,e=this.keyMap;this.values.length=0;for(t in e)delete e[t]},t.prototype.getIdByIndex=function(t){var e,n=this.keyMap;for(e in n)if(n[e]===t)return e;return""},t.prototype.getKeys=function(){var t,e=this.size(),n=[];for(t=0;e>t;t++)n.push(this.getIdByIndex(t));return n},t.prototype.getValues=function(){return this.values},t.prototype.size=function(){return this.values.length},t}),CommonJS?kilo.register("Http",["Util"],function(t){function e(t,e){switch(t){case"application/json":case"application/json; charset=utf-8":return JSON.parse(e);default:return e}}function n(n,r,o){var i=new Promise(function(i,s){var u=http.request(n,function(n){var u="";t.isFunction(r)&&(o=r,r=null),n.setEncoding("utf8"),n.on("data",function(t){u+=t,o&&o(t.length,u.length)}),n.on("end",function(){var t=n.headers["content-type"];switch(n.statusCode){case 500:s({statusText:"",status:n.statusCode});break;case 404:s({statusText:"",status:n.statusCode});break;case 304:i({data:e(t,u),status:n.statusCode});break;default:i({data:e(t,u),status:n.statusCode})}})});u.on("error",function(t){console.log("problem with request: "+t.message),console.log("URL: "+n),s("Network error.")}),u.end()});return i}return{get:n}}):register("Http",["Util"],function(t){"use strict";function e(t,e){switch(t){case"application/json":case"application/json; charset=utf-8":return JSON.parse(e);default:return e}}function n(n,r,o){return new Promise(function(i,s){var u=new XMLHttpRequest;t.isFunction(r)&&(o=r,r=null),o&&u.addEventListener("progress",function(t){o(t.loaded,t.total)},!1),u.onerror=function(){s(t.error("Network error."))},u.onload=function(){var t=r||this.getResponseHeader("content-type");switch(this.status){case 500:s({statusText:this.statusText,status:this.status});break;case 404:s({statusText:this.statusText,status:this.status});break;case 304:i({data:e(t,this.responseText),status:this.status});break;default:i({data:e(t,this.responseText),status:this.status})}},u.open("get",n,!0),u.send()})}return{get:n}}),register("KeyStore",["HashArray","Util"],function(t,e){"use strict";function n(){this.lastId=0,this.store=new t}return n.prototype.get=function(t){return this.store.get(t)},n.prototype.set=function(t,n){var r;return e.isDefined(n)?r=t||this.lastId++:(r=this.lastId++,n=t),this.store.add(r,n),r},n.prototype.setGroup=function(t,n){var r,o;return e.isDefined(n)?(r=t,e.isDefined(r)?o=this.get(r):(r=this.lastId++,o=[],this.store.add(r,o))):(r=this.lastId++,n=t,o=[],this.store.add(r,o)),o?o.push(n):console.error("Jack2d: keyStore: id '"+r+"' not found."),r},n.prototype.clear=function(t){e.isDefined(t)?this.store.remove(t):this.store.removeAll()},n.prototype.getItems=function(){return this.store.items},n}),register("Merge",["Obj"],function(t){"use strict";return t.merge.bind(t)}),register("Obj",["Injector","Util","Func","Pool"],function(t,e,n,r){"use strict";function o(t,e,n,o){return t=t||r.getObject(),e=e||r.getObject(),Object.keys(t).forEach(function(r){i(t,e,r,n,o)}),e}function i(t,r,o,i,s){return r.hasOwnProperty(o)?i?(r[o]=n.wrap(r[o],t[o]),e.log("Merge: wrapped '"+o+"'")):s?e.error("Failed to merge mixin. Method '"+o+"' caused a name collision."):(r[o]=t[o],e.log("Merge: overwrote '"+o+"'")):r[o]=t[o],r}function s(t,n){var r={};return Object.keys(t).forEach(function(o){e.isFunction(t[o])&&(r[o]=u(t[o],t,n))}),r}function u(t,n,r){return function(){var o=e.argsToArray(arguments);return r?(o.unshift(t),r.apply(n,o)):t.apply(n,o)}}function c(t,e,n){Object.keys(t).forEach(function(r){t[r]===e&&(t[r]=n)})}function a(t,e){return s(t,e)}function l(t){return f(t)}function f(t,e){var n;e=e||r.getObject();for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function h(t){var n,r="";if(e.isObject(t))for(n in t)t.hasOwnProperty(n)&&!e.isFunction(t[n])&&(r+=n+": "+t[n]+"<br>");return r}function p(t){var e;for(e in t)t.hasOwnProperty(e)&&delete t[e];return t}function d(t){return g(t)}function g(e,n,r){return t.process(e,function(t){n=o(t,n,!1,r)}),n}function m(e,n){return t.process(e,function(t){n=o(t,n,!0)}),n}return{print:h,clear:p,clone:d,quickClone:l,merge:g,quickMerge:f,wrap:m,augment:a,replaceMethod:c}}),register("Pool",[],function(){"use strict";function t(){var t=o.pop();return t||(t={}),t}function e(t){var e;for(e in t)t.hasOwnProperty(e)&&delete t[e];return t}function n(t){o.push(e(t))}function r(){return o.length}var o=[];return{getObject:t,killObject:n,available:r}}),register("rect",[],function(){"use strict";function t(t,e,n){return!(t<n.left||t>n.right||e<n.top||e>n.bottom)}function e(t,e){return!(t.left<e.left||t.right>e.right||t.top<e.top||t.bottom>e.bottom)}function n(t,e){var n=!(t.left<e.left||t.right>e.right);return n?!1:t.left-e.left}function r(t,e){return!(t<e.left||t>e.right)}function o(t,e){var n=!(t.top<e.top||t.bottom>e.bottom);return n?!1:t.top-e.top}function i(t,e){return!(t<e.top||t>e.bottom)}function s(t,e){var n=!(e.left>=t.right||e.right<=t.left);return n?t.left-e.left:!1}function u(t,e){var n=!(e.top>=t.bottom||e.bottom<=t.top);return n?t.top-e.top:!1}return{setLeft:function(t){return this.left=t,this},setTop:function(t){return this.top=t,this},setRight:function(t){return this.right=t,this},setBottom:function(t){return this.bottom=t,this},containsPoint:t,containsRect:e,containsX:r,containsY:i,containsRectX:n,containsRectY:o,intersectsRectX:s,intersectsRectY:u}}),register("Str",[],function(){"use strict";function t(){var t,e;return t=arguments[0],e=Array.prototype.slice.call(arguments,1),e.forEach(function(e){t=t.replace("%%",e)}),t}return{sprintf:t}}),register("Wrap",["Obj"],function(t){"use strict";return t.wrap.bind(t)}),Array.prototype.forEach||(Array.prototype.forEach=function(t,e){var n,r;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),i=o.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(n=e),r=0;i>r;){var s;r in o&&(s=o[r],t.call(n,s,r,o)),r++}}),Array.prototype.map||(Array.prototype.map=function(t,e){var n,r,o;if(null==this)throw new TypeError(" this is null or not defined");var i=Object(this),s=i.length>>>0;if("function"!=typeof t)throw new TypeError(t+" is not a function");for(arguments.length>1&&(n=e),r=new Array(s),o=0;s>o;){var u,c;o in i&&(u=i[o],c=t.call(n,u,o,i),r[o]=c),o++}return r}),function(){function t(t,e){return function(){t.apply(e,arguments)}}function e(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],u(e,t(r,this),t(o,this))}function n(t){var e=this;return null===this._state?void this._deferreds.push(t):void a(function(){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return void(e._state?t.resolve:t.reject)(e._value);var r;try{r=n(e._value)}catch(o){return void t.reject(o)}t.resolve(r)})}function r(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if("function"==typeof n)return void u(t(n,e),t(r,this),t(o,this))}this._state=!0,this._value=e,i.call(this)}catch(s){o.call(this,s)}}function o(t){this._state=!1,this._value=t,i.call(this)}function i(){for(var t=0,e=this._deferreds.length;e>t;t++)n.call(this,this._deferreds[t]);this._deferreds=null}function s(t,e,n,r){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=n,this.reject=r}function u(t,e,n){var r=!1;try{t(function(t){r||(r=!0,e(t))},function(t){r||(r=!0,n(t))})}catch(o){if(r)return;r=!0,n(o)}}var c;c="object"==typeof window&&window?window:global,"undefined"!=typeof module&&module.exports?module.exports=c.Promise?c.Promise:e:c.Promise||(c.Promise=e);var a=c.setImmediate||function(t){setTimeout(t,1)},l=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)};e.prototype["catch"]=function(t){return this.then(null,t)},e.prototype.then=function(t,r){var o=this;return new e(function(e,i){n.call(o,new s(t,r,e,i))})},e.all=function(){var t=Array.prototype.slice.call(1===arguments.length&&l(arguments[0])?arguments[0]:arguments);return new e(function(e,n){function r(i,s){try{if(s&&("object"==typeof s||"function"==typeof s)){var u=s.then;if("function"==typeof u)return void u.call(s,function(t){r(i,t)},n)}t[i]=s,0===--o&&e(t)}catch(c){n(c)}}if(0===t.length)return e([]);for(var o=t.length,i=0;i<t.length;i++)r(i,t[i])})},e.resolve=function(t){return t&&"object"==typeof t&&t.constructor===e?t:new e(function(e){e(t)})},e.reject=function(t){return new e(function(e,n){n(t)})},e.race=function(t){return new e(function(e,n){for(var r=0,o=t.length;o>r;r++)t[r].then(e,n)})}}(),register("SchedulerObject",["Util","Scheduler","Func"],function(t,e,n){"use strict";return{onFrame:function(n,r){var o=t.getGID(r);return this.schedulerIds||(this.schedulerIds=[]),this.hooks||(this.hooks={}),n=n.bind(this),r&&(this.hooks[r]=o),this.schedulerIds.push(e.register(n,o)),this},getSchedulerId:function(t){return this.hooks?this.hooks[t]:null},hook:function(t,r){var o,i=this.getSchedulerId(t);return i&&(o=e.getRegistered(i),o=n.wrap(o,r),e.register(o,i)),this},killOnFrame:function(t){return t?e.unRegister(t):this.schedulerIds&&this.schedulerIds.forEach(function(t){e.unRegister(t)}),this}}}),register("Scheduler",["HashArray","Util"],function(t,e){"use strict";function n(){return r(),l(),C}function r(){return y=60,b=0,P=0,A=0,j=0,k=0,F=new t,x=!1,R=new Date,C}function o(t,n){return e.isFunction(t)||e.error("Scheduler: only functions can be registered."),n||(n=e.getGID(n)),F.set(n,t),n}function i(t,e,n){return n||(n=j++),F.splice(t,n,e),n}function s(t){return F.remove(t),C}function u(t){return t?F.get(t):F.getValues()}function c(){I=window.requestAnimationFrame(h)}function a(){return F.size()}function l(){return x||(x=!0,O=window.setInterval(m,T),h()),C}function f(){return x=!1,window.clearInterval(O),window.cancelAnimationFrame(I),C}function h(){p(d()),g(),x&&c()}function p(t){var e,n,r,o;for(e=F.getValues(),n=e.length,o=0;n>o;o++)r=e[o],r&&r(t)}function d(){var t=+new Date,e=(t-R)/T;return R=t,e}function g(){P++}function m(){b=P.toString(),P=0,A++}function v(){return b}function w(){return A}var y,b,P,x,A,F,j,k,O,I,R,C,T=1e3;return n(),C={__mixin:!1,init:n,reset:r,start:l,stop:f,register:o,registerAfter:i,unRegister:s,getRegistered:u,registeredCount:a,getFps:v,getSeconds:w}}),function(){for(var t=0,e=["ms","moz","webkit","o"],n=0;n<e.length&&!window.requestAnimationFrame;++n)window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var n=(new Date).getTime(),r=Math.max(0,16-(n-t)),o=window.setTimeout(function(){e(n+r)},r);return t=n+r,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),register("CommandObject",["Util","Obj","Injector"],function(t,e,n){"use strict";function r(t,e){return t.commandRunner.add(e),t}function o(){return r(this,{end:!0})}function i(t){var e=Array.prototype.slice.call(arguments,1);return r(this,{func:t,sourceAsArg:!0,args:e,context:this})}function s(t){return this.end(),r(this,{watchProp:t,lastValue:this.commandRunner.context[t],logicals:[],specials:[]})}function u(t,e){return this.end(),this.when(t,e,!0)}function c(){return r(this,{endGroup:!0})}function a(e,n,o){return this.end(),r(this,{whenProp:e,whenValue:n,isFunc:t.isFunction(n),logicals:[],specials:[],commands:[],group:o})}function l(t){return this.end(),this.when(t,!1)}function f(e,n){return r(this,{isLogical:!0,logicalProp:e,logicalValue:n,logicalType:"and",isFunc:t.isFunction(n),specials:[]})}function h(e,n){return r(this,{isLogical:!0,logicalProp:e,logicalValue:n,logicalType:"or",isFunc:t.isFunction(n),specials:[]})}function p(t,e){return this.end(),r(this,{eventName:t,func:e})}function d(e,o,i){var s;return t.isDefined(i)?(n.process(e,function(t){r(this,{setProp:o,setValue:i,inc:!1,context:t})}.bind(this)),this):r(this,{setProp:e,setValue:o,inc:!1,context:s})}function g(t,e,n){return r(this,{setProp:t,setValue:e,inc:!0,format:n})}function m(t){var e=Array.prototype.slice.call(arguments,1);return r(this,{func:t,args:e})}function v(t){return r(this,{logValue:t})}function w(){return this.commandRunner.context}return{commandRunner:null,logicMode:"",end:o,get:i,watch:s,whenGroup:u,endGroup:c,when:a,whenNot:l,andWhen:f,orWhen:h,set:d,inc:g,on:p,call:m,log:v,source:w}}),register("CommandRunner",["Util","Scheduler"],function(t,e){"use strict";function n(t,e){function n(t,e){return t?2===e.length?t[e[0]]:n(t[e[0]],e.slice(1)):t}var r=e.split(".");return 1===r.length?t:n(t,r)}function r(t){return t.split(".").slice(-1)[0]}function o(t,e){this.chronoId=e,this.context=t,this.running=!1,this.conditional=null,this.waitQueue=[],this.specialQueue=null}return o.prototype.add=function(t){this.running?(t=this.preProcessCommand(t),this.evaluateCommand(t)):this.waitQueue.push(t)},o.prototype.go=function(){this.running=!0,this.evaluateCommands()},o.prototype.preProcessCommand=function(t){return t.setProp?(t.context=n(t.context||this.context,t.setProp),t.setProp=r(t.setProp)):t.whenProp?(t.context=n(this.context,t.whenProp),t.whenProp=r(t.whenProp)):t.watchProp?(t.context=n(this.context,t.watchProp),t.whenProp=r(t.watchProp)):t.logicalProp?(t.context=n(this.context,t.logicalProp),t.logicalProp=r(t.logicalProp)):t.eventName&&(t.context=n(this.context,t.eventName),t.eventName=r(t.eventName)),t},o.prototype.evaluateCommands=function(){var t,e;for(e=this.waitQueue;t=e.shift();)t=this.preProcessCommand(t),this.evaluateCommand(t)},o.prototype.evaluateCommand=function(t){if(t.whenProp||t.watchProp)this.specialQueue||(this.specialQueue=this.repeatQueue()),this.specialQueue.push(t);else if(t.eventName)this.specialQueue=this.eventQueue(t);else if(t.end)this.specialQueue=null;else{if(!this.specialQueue)return this.executeCommand(t);this.specialQueue.push(t)}return null},o.prototype.repeatQueue=function(){var n=[];return this.chronoId?e.registerAfter(this.chronoId,function(){this.processRepeatCommands(n)}.bind(this),t.getGID("command-repeat")):e.register(function(){this.processRepeatCommands(n)}.bind(this),t.getGID("command-repeat")),n},o.prototype.eventQueue=function(t){var e=[],n=t.context,r=this;return n.addEventListener&&n.addEventListener(t.eventName,function(n){var o,i=e.length;for(t.func&&t.func.call(t.context,n),o=0;i>o;o++)r.executeCommand(e[o])}),e},o.prototype.processRepeatCommands=function(t){var e,n,r=null,o=null,i=0;for(e=t.length;e>i;)n=t.shift(),n.group?o=n:n.endGroup?o=null:n.whenProp||n.watchProp?(r=n,r.logicals.length=0):r&&n.isLogical?r.logicals.push(n):o?this.evaluateConditional(o)&&r&&this.evaluateConditional(r)&&this.executeCommand(n):r&&this.evaluateConditional(r)&&this.executeCommand(n),t.push(n),i++},o.prototype.checkWatch=function(t){var e=t.context;return e[t.watchProp]!==t.lastValue?(t.lastValue=e[t.watchProp],!0):!1},o.prototype.evaluateConditional=function(e){var n=e.context;return e.isFunc&&e.whenValue.call(n,n[e.whenProp])||e.watchProp&&this.checkWatch(e,n)||e.whenProp&&t.isDefined(e.whenValue)&&n[e.whenProp]===e.whenValue||e.whenProp&&!t.isDefined(e.whenValue)&&t.isDefined(n[e.whenProp])?e.logicals.length>0?this.evaluateLogical(e.logicals,e.whenProp||e.watchProp,!0):!0:e.logicals.length>0?this.evaluateLogical(e.logicals,e.whenProp||e.watchProp,!1):!1},o.prototype.evaluateLogical=function(e,n,r){var o,i,s,u,c;for(u=0,o=e.length;o>u;u++)if(i=e[u],s=i.logicalType,n=i.logicalProp||n,c=i.context,i.isFunc)if(i.logicalValue.call(c,c[n])){if("or"===s)return!0}else"and"===s&&(r=!1);else if(t.isDefined(c[n])){if("or"===s)return!0}else"and"===s&&(r=!1);return r},o.prototype.executeCommand=function(e){var n,r,o,i=e.context;return e.eventName?i.addEventListener&&i.addEventListener(e.eventName,e.func):e.func?(e.sourceAsArg&&e.args.unshift(i),e.func.apply(e.context||i,e.args)):e.logValue?t.log(e.logValue):e.setProp&&(r=e.setProp,e.inc?"px"===e.format?e.context[r]?(o=e.context[r],e.context[r]=parseInt(o)+e.setValue+"px"):e.context[r]=e.setValue+"px":"%"===e.format?e.context[r]?(o=e.context[r],e.context[r]=parseInt(o)+e.setValue+"%"):e.context[r]=e.setValue+"%":(e.context[r]||(e.context[r]=e.setValue),e.context[r]+=e.setValue):e.context[r]=e.setValue),n},o}),kilo("FlowDefinition",["helper","obj","FlowObject"],function(t,e,n){"use strict";function r(t){var r=e.create(n);return r.init(t,1,!0)}return r}),use(["Func","registerAll"],function(t,e){"use strict";e({greaterThan:t.fastPartial(function(t,e){return e>t}),lessThan:t.fastPartial(function(t,e){return t>e}),between:t.fastPartial(function(t,e,n){return n>t&&e>n}),greaterThanOrEqual:t.fastPartial(function(t,e){return e>=t}),lessThanOrEqual:t.fastPartial(function(t,e){return t>=e}),betweenInclusive:t.fastPartial(function(t,e,n){return n>=t&&e>=n}),outside:t.fastPartial(function(t,e,n){return t>n&&n>e}),and:t.fastPartial(function(){})})}),register("FlowObject").depends("Util","Injector","Obj","CommandRunner","CommandObject").factory(function(t,e,n,r,o){"use strict";function i(t,e){return-1!==Object.keys(e).indexOf(t)}function s(e,n){Object.keys(e).forEach(function(r){t.isFunction(e[r])&&!i(r,a)&&(n.__savedFunctions||(n.__savedFunctions={}),n.__savedFunctions[r]=e[r],n[r]=u(n,e[r]))})}function u(t,e){return function(){return t.call(e)}}function c(t,e,n){return t[e].apply(t,n)}var a={after:function(t){return this.hookId=t,this},on:function(){return c(this.flow(),"on",arguments)},when:function(){return c(this.flow(),"when",arguments)},whenGroup:function(){return c(this.flow(),"whenGroup",arguments)},whenNot:function(){return c(this.flow(),"whenNot",arguments)},watch:function(){return c(this.flow(),"watch",arguments)},flow:function(t){return this.instance(this,t)},model:function(t,e){return this.instance(t,e,!0)},instance:function(t,i,u){var c=n.merge(o);return c.commandRunner=new r(null,i),e.process(t,function(e){t=u?{$:e}:e,s(t,c),c.commandRunner.context=t,c.commandRunner.go()}),c}};return a}),use(["Util","FlowObject","registerAll"],function(t,e,n){"use strict";n({Flow:function(t,n){return e.instance(t,n)},"Flow.When":function(t,n,r){return e.instance(t).when(n,r)},"Flow.Watch":function(t,n){return e.instance(t).watch(n)},"Flow.On":function(t,n,r){return e.instance(t).on(n,r)},"Flow.Model":function(t,n){return e.model(t,n)}})}),kilo("Results",["Util"],function(t){"use strict";return{add:function(e,n){this.sets=t.def(this.sets,[]),this.count=t.isDefined(this.count)?this.count+1:0,this.sets.push({commandRunners:n,sourceObjects:e,addCommand:function(e,n){var r=this.commandRunners;t.isDefined(n)&&n<r.length?r[n].add(e):r.forEach(function(t){t.add(e)})}})},get:function(t){return this.sets[t]},current:function(){return this.sets[this.count]},next:function(){return this.sets[this.count+1]},last:function(){return this.sets[this.count-1]}}}),function(){"use strict";Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,r=function(){},o=function(){return n.apply(this instanceof r&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return r.prototype=this.prototype,o.prototype=new r,o})}();